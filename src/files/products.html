<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin â€“ Product Manager</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />

  <style>
      * {
          box-sizing: border-box;
          font-family: Arial, sans-serif;
      }

      body {
          margin: 0;
          background: #f4f6f8;
          padding: 16px;
      }

      h2 {
          margin-top: 32px;
      }

      .card {
          background: #fff;
          padding: 16px;
          border-radius: 8px;
          margin-bottom: 20px;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      input, textarea, select, button {
          width: 100%;
          padding: 10px;
          margin-top: 8px;
          border-radius: 6px;
          border: 1px solid #ccc;
          font-size: 14px;
      }

      button {
          background: #2563eb;
          color: white;
          border: none;
          cursor: pointer;
          margin-top: 12px;
      }

      button.secondary {
          background: #10b981;
      }

      button.danger {
          background: #ef4444;
      }

      .product {
          display: flex;
          gap: 12px;
          margin-bottom: 12px;
          border-bottom: 1px solid #eee;
          padding-bottom: 12px;
      }

      .product img {
          width: 80px;
          height: 80px;
          object-fit: cover;
          border-radius: 6px;
      }

      .product-info {
          flex: 1;
      }

      .badge {
          display: inline-block;
          padding: 4px 8px;
          font-size: 12px;
          border-radius: 4px;
          background: #e5e7eb;
          margin-right: 6px;
      }

      .row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 10px;
      }

      @media (max-width: 600px) {
          .row {
              grid-template-columns: 1fr;
          }
      }
  </style>
</head>
<body>

<h1>ðŸ›  Admin Product Panel</h1>

<h2><a href="orders.html">Orders</a></h2>
<h2><a href="upload-image.html">Upload Image</a></h2>

<!-- CREATE / UPDATE PRODUCT -->
<div class="card">
  <h2 id="formTitle">Create Product</h2>

  <input id="password" placeholder="Admin Password" type="password" />

  <input id="namee" placeholder="Product Name" type="text" />
  <input id="price" placeholder="Price" type="number" />

  <input id="image" placeholder="Image URL" type="text" />

  <textarea id="description" placeholder="Description"></textarea>

  <div class="row">
    <select id="category">
      <option value="">Select Category</option>
      <option value="general">General</option>
      <option value="dessert">Dessert</option>
      <option value="drinks">Drinks</option>
      <option value="snack">Snack</option>
      <option value="bread">Bread</option>
      <option value="nonVeg">Non-Veg</option>
      <option value="other">Other</option>
    </select>

    <select id="statuss">
      <option value="">Status</option>
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
    </select>
  </div>

  <select id="isAvailable">
    <option value="">Is Available?</option>
    <option value="true">Yes</option>
    <option value="false">No</option>
  </select>

  <button onclick="submitProduct()">Save Product</button>
  <button class="secondary" onclick="resetForm()">Reset</button>
</div>

<!-- PRODUCT LIST -->
<div class="card">
  <h2>Product List</h2>
  <div id="productList"></div>
</div>

<script>
  const API = '/products';
  let editingId = null;

  async function loadProducts() {
    const pass = localStorage.getItem('admin_pass');
    if (pass) {
      document.getElementById('password').value = pass;
    }
    const res = await fetch(API);
    const products = await res.json();

    const list = document.getElementById('productList');
    list.innerHTML = '';

    products.forEach(p => {
      const div = document.createElement('div');
      div.className = 'product';

      div.innerHTML = `
        <img src="${p.image}" />
        <div class="product-info">
          <strong>${p.name}</strong><br/>
          â‚¹${p.price}<br/>
          <span class="badge">${p.category}</span>
          <span class="badge">${p.status}</span>
          <span class="badge">${p.isAvailable ? 'Available' : 'Unavailable'}</span>
          <br/><br/>
          <button onclick='editProduct(${JSON.stringify(p)})'>Edit</button>
        </div>
      `;

      list.appendChild(div);
    });
  }

  function editProduct(p) {
    editingId = p._id;

    document.getElementById('formTitle').innerText = 'Update Product';

    document.getElementById('namee').value = p.name || '';
    document.getElementById('price').value = p.price || '';
    document.getElementById('image').value = p.image || '';
    document.getElementById('description').value = p.description || '';

    // IMPORTANT: value must match option value EXACTLY
    document.getElementById('category').value = p.category;
    document.getElementById('statuss').value = p.status; // active / inactive
    document.getElementById('isAvailable').value = String(p.isAvailable);
  }

  async function submitProduct() {
    const payload = {
      password: password.value,
      name: namee.value,
      price: Number(price.value),
      image: image.value,
      description: description.value,
      category: category.value,
      isAvailable: isAvailable.value === 'true',
      status: statuss.value,
    };

    const options = {
      method: editingId ? 'PATCH' : 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    };
    localStorage.setItem('admin_pass', payload.password);

    const url = editingId ? `${API}/${editingId}` : API;
    await fetch(url, options);

    resetForm();
    loadProducts();
  }

  function resetForm() {
    editingId = null;
    document.getElementById('formTitle').innerText = 'Create Product';
    document.querySelectorAll('input, textarea, select').forEach(el => el.value = '');
  }

  loadProducts();
</script>

</body>
</html>
